[SERVICE]
    Flush        0.5
    Daemon       off
    Log_Level    debug
    Parsers_File parsers.conf

[INPUT]
    Name          disk
    Tag           metrics.disk
    Interval_Sec  1
    Interval_Nsec 0

[INPUT]
    Name          cpu
    Tag           metrics.cpu
    Interval_Sec  1

[INPUT]
    Name          mem
    Tag           metrics.mem
    Interval_Sec  1

[INPUT]
    Name         tail
    Path         /var/log/**/*.log
    Tag          logs.text
    Inotify_Watcher false
    Parser       json_parser
    Refresh_Interval 0.5

[FILTER]
    Name    grep
    Match   logs.text
    Regex   log .*

[FILTER]
    Name    modify
    Match   metrics.*
    Condition Key_Value_Matches tag metrics\.(cpu|mem|disk)
    Set     tag %{tag}

[OUTPUT]
    Name              forward
    Match             *
    Host              ${FLUENTBIT_MASTER_HOST}
    Port              2021
    Buffer_Chunk_Size 128k
    Buffer_Max_Size   256k
    Flush_Interval    0.5
    Retry_Limit       5
    Net.Keepalive     On
    Net.Keepalive_Idle_Timeout 10